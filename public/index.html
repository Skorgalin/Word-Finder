<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Word Finder</title>

<style>
body { font-family: Arial; padding:20px; }
input, button { font-size:16px; margin:5px; outline:none; }

#foundWindow { margin-top:10px; }

.ultraBox{
  position:fixed;
  top:20%;
  left:50%;
  transform:translateX(-50%);
  background:white;
  padding:20px;
  border:3px solid gold;
  animation:glow 1.5s infinite alternate;
  z-index:999;
  text-align:center;
}

@keyframes glow{
  from{box-shadow:0 0 10px gold;}
  to{box-shadow:0 0 30px gold;}
}

.announcement{
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  background:white;
  padding:8px 12px;
  margin-top:5px;
}
</style>
</head>

<body>

<h2>Word Finder Game</h2>

<div id="login">
  <input id="email" placeholder="E-Mail">
  <button onclick="login()">Login</button>
</div>

<div id="game" style="display:none;">
  <input id="input">
  <button onclick="submit()">Enter</button>
  <button onclick="toggleFound()">Found Items</button>
  <button id="adminBtn" style="display:none;" onclick="openAdmin()">Admin</button>

  <div id="foundWindow"></div>
</div>

<script>
const ADMIN_MAIL = "till.behner@icloud.com";
const ADMIN_PASSWORD = "X9$QvR7!eM2#A8wK@C";
const ultraRare = ["ðŸŒŸ","ðŸ’Ž","âœ¨"];

let email = "";
let found = {};
let adminUnlocked = false;

function login(){
  email = document.getElementById("email").value;
  document.getElementById("login").style.display="none";
  document.getElementById("game").style.display="block";
  if(email === ADMIN_MAIL){
    document.getElementById("adminBtn").style.display="inline";
  }
}

function submit(){
  const val = document.getElementById("input").value.trim();
  if(!val) return;
  document.getElementById("input").value = "";

  fetch(`/getItem/${val}/USER`)
    .then(r=>r.json())
    .then(d=>{
      if(!found[val]){
        found[val]=d;
        if(d.ultra) showUltra(d.result);
      }
    });
}

function toggleFound(){
  foundWindow.innerHTML="<h3>Found Items</h3>";
  for(let k in found){
    foundWindow.innerHTML += `${k} â†’ ${found[k].result}` +
      (found[k].ultra ? " ðŸŒŸ Ultraselten" : " <b>First Discovery</b>") +
      "<br>";
  }
}

function showUltra(item){
  const box=document.createElement("div");
  box.className="ultraBox";
  box.innerHTML="<b>ðŸŒŸ ULTRASELTEN ðŸŒŸ</b><br><div style='font-size:40px'>"+item+"</div>";
  document.body.appendChild(box);
  setTimeout(()=>box.remove(),3500);
}

function openAdmin(){
  if(!adminUnlocked){
    const p=prompt("Admin Passwort:");
    if(p!==ADMIN_PASSWORD) return;
    adminUnlocked=true;
  }

  const action = prompt("Admin: Tippe 1 fÃ¼r Suche, 2 fÃ¼r AnkÃ¼ndigung");
  if(action==="1") adminSearch();
  if(action==="2") adminAnnounce();
}

function adminSearch(){
  const item = prompt("Item suchen:");
  if(!item) return;

  fetch(`/getItem/${item}/ADMIN`)
    .then(r=>r.json())
    .then(d=>{
      let category = "ðŸ“– WÃ¶rter";

      if(ultraRare.includes(d.result)){
        category = "ðŸŒŸ Ultraselten";
      } else if(/^[a-zA-Z]+$/.test(item)){
        category = "ðŸ”¤ Buchstabenfolge";
      } else if(item.length === 1 && item.match(/\p{Emoji}/u)){
        category = "ðŸ˜€ Emoji";
      }

      const choice = prompt(
        `Item: ${item}\nKategorie: ${category}\nErgebnis: ${d.result}\n\n1=Ã„ndern\n2=SchlieÃŸen`
      );

      if(choice==="1" && category!=="ðŸŒŸ Ultraselten"){
        changeRequirement(item);
      }
    });
}

function changeRequirement(item){
  const newInput = prompt("Neue Eingabe fÃ¼r dieses Item:");
  if(!newInput) return;

  fetch("/admin/update",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      item:item,
      input:newInput,
      password:ADMIN_PASSWORD
    })
  })
  .then(r=>r.json())
  .then(()=>alert("âœ… Item wurde geÃ¤ndert"));
}

function adminAnnounce(){
  const t = prompt("Text fÃ¼r AnkÃ¼ndigung:");
  if(!t) fetch("/announcement",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({text:t})
  });
}
</script>

</body>
</html>
