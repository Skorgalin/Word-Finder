<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Word Finder</title>
<style>
body { font-family: Arial; padding: 15px; }
input, button { font-size: 16px; margin: 4px 0; }
#game, #adminPanel, #found { display:none; }
.announcement {
  background:white;
  color:black;
  padding:6px;
  margin:4px 0;
  transition: opacity 1s;
}
</style>
</head>
<body>

<h2>Word Finder</h2>

<input id="email" placeholder="E-Mail">
<input id="password" type="password" placeholder="Passwort">
<button id="loginBtn" style="display:none" onclick="login()">Login</button>
<button id="regBtn" style="display:none" onclick="register()">Registrieren</button>

<div id="game">
  <input id="word" placeholder="Wort eingeben">
  <button onclick="submit()">OK</button>
  <button onclick="toggleFound()">Found Items</button>
  <button id="adminBtn" style="display:none" onclick="adminLogin()">Admin</button>
  <div id="found"></div>
</div>

<div id="adminPanel">
  <h3>Admin</h3>
  <input id="aText" placeholder="Ankündigung">
  <button onclick="announce()">Senden</button>
  <input id="aSearch" placeholder="Suche">
  <button onclick="search()">Suchen</button>
  <div id="aResult"></div>
</div>

<div id="announcements"></div>

<script>
let email="", isAdmin=false, found=[];
const ADMIN_PW="X9$QvR7!eM2#A8wK@C";

emailInput = document.getElementById("email");
emailInput.oninput = async ()=>{
  const r = await fetch("/checkEmail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:emailInput.value})});
  const d = await r.json();
  loginBtn.style.display = d.exists?"block":"none";
  regBtn.style.display = d.exists?"none":"block";
};

async function register(){
  await fetch("/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:email.value,password:password.value})});
  alert("Registriert!");
}

async function login(){
  email=emailInput.value;
  const r = await fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email,password:password.value})});
  const d = await r.json();
  if(!d.ok) return alert("Falsch");
  isAdmin=d.admin;
  game.style.display="block";
  if(isAdmin) adminBtn.style.display="inline";
}

async function submit(){
  const w=word.value;
  word.value="";
  const r=await fetch("/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email,input:w,isAdmin})});
  const d=await r.json();
  found.push(`${w} → ${d.output}${d.firstDiscovery?" (First Discovery)":""}`);
  render();
}

function toggleFound(){ foundDiv.style.display = foundDiv.style.display==="none"?"block":"none"; }
function render(){ foundDiv.innerHTML=found.join("<br>"); }

function adminLogin(){
  if(prompt("Admin Passwort")===ADMIN_PW) adminPanel.style.display="block";
}

async function search(){
  const r=await fetch("/admin/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:aSearch.value})});
  const d=await r.json();
  aResult.textContent=`${aSearch.value} → ${d.output}`;
}

async function announce(){
  await fetch("/admin/announce",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:aText.value})});
  show(aText.value);
  aText.value="";
}

function show(t){
  const d=document.createElement("div");
  d.className="announcement";
  d.textContent=t;
  announcements.appendChild(d);
  setTimeout(()=>{d.style.opacity=0;setTimeout(()=>d.remove(),1000)},3000+t.length*80);
}
</script>

</body>
</html>
