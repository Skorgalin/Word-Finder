<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Word Finder</title>
<style>
body { font-family: Arial; padding: 15px; font-size:18px; }
input, button { font-size:18px; width:100%; margin:5px 0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; outline:none; }
#adminPanel,#foundItems { display:none; margin-top:10px; border:1px solid #000; padding:10px; max-height:300px; overflow:auto; }
#game,#login,#codeBox { max-width:500px; margin:0 auto; }

.announcement { position:relative; background:white; padding:6px 10px; border:1px solid black; margin:3px 0; }

.ultra { animation: glow 1.5s infinite alternate; border:3px solid gold; }
@keyframes glow { from {box-shadow:0 0 5px gold;} to {box-shadow:0 0 20px gold;} }
</style>
</head>
<body>

<h2>Word Finder Game</h2>

<div id="login">
  <input id="email" placeholder="E-Mail">
  <input id="password" type="password" placeholder="Passwort">
  <button id="registerBtn" style="display:none;" onclick="register()">Registrieren</button>
  <button id="loginBtn" style="display:none;" onclick="login()">Login</button>
</div>

<div id="game" style="display:none;">
  <input id="word" placeholder="Wort eingeben">
  <button onclick="submitWord()">OK</button>
  <button onclick="toggleFound()">Found Items</button>
  <button id="adminBtn" style="display:none;" onclick="toggleAdmin()">Admin</button>
  <div id="foundItems"></div>

  <div id="adminPanel">
    <h3>Admin Dashboard</h3>
    <div>
      <input id="searchText" placeholder="Suchen">
      <select id="category">
        <option value="">Alle Kategorien</option>
        <option value="Wörter">Wörter</option>
        <option value="Emojis">Emojis</option>
        <option value="Zeichenfolge">Zeichenfolge</option>
        <option value="Buchstabenfolge">Buchstabenfolge</option>
        <option value="Buchstaben/Zeichenfolge">Buchstaben/Zeichenfolge</option>
        <option value="Ultraselten">Ultraselten</option>
      </select>
      <button onclick="searchItems()">Suchen</button>
      <div id="searchResults"></div>
    </div>
    <div>
      <input id="announceText" placeholder="Ankündigung">
      <button onclick="announce()">Ankündigen</button>
    </div>
  </div>
</div>

<div id="announcements"></div>

<script>
let email="",isAdmin=false,found=[],items={};

// Prüfen ob Nutzer existiert
document.getElementById("email").addEventListener("input",()=>{
  fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:document.getElementById("email").value,password:""})})
  .then(r=>r.json()).then(d=>{
    if(d.ok===false){ document.getElementById("registerBtn").style.display="inline"; document.getElementById("loginBtn").style.display="none"; }
    else{ document.getElementById("registerBtn").style.display="none"; document.getElementById("loginBtn").style.display="inline"; }
  });
});

function register(){
  const pass=document.getElementById("password").value;
  email=document.getElementById("email").value;
  fetch("/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email,password:pass})})
  .then(r=>r.json()).then(d=>{
    if(d.ok){startGame(true);}
    else alert(d.msg);
  });
}

function login(){
  const pass=document.getElementById("password").value;
  email=document.getElementById("email").value;
  fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email,password:pass})})
  .then(r=>r.json()).then(d=>{
    if(d.ok){startGame(d.admin);}
    else alert(d.msg);
  });
}

function startGame(admin){
  isAdmin=admin;
  document.getElementById("login").style.display="none";
  document.getElementById("game").style.display="block";
  if(isAdmin) document.getElementById("adminBtn").style.display="inline";
  loadAnnouncements();
  loadItems();
}

function submitWord(){
  const w=document.getElementById("word").value;
  if(!w) return;
  fetch("/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email,input:w})})
  .then(r=>r.json()).then(d=>{
    if(d.ok){
      if(!found.includes(w)) found.push(w);
      renderFound();
      document.getElementById("word").value="";
    }
  });
}

function renderFound(){
  document.getElementById("foundItems").innerHTML="<b>Found Items:</b><br>"+found.join("<br>");
}

function toggleFound(){
  const f=document.getElementById("foundItems");
  f.style.display=f.style.display==="none"?"block":"none";
}

function toggleAdmin(){
  const pass=prompt("Admin Passwort eingeben");
  if(pass=== "X9$QvR7!eM2#A8wK@C"){ document.getElementById("adminPanel").style.display="block"; }
  else alert("Falsches Passwort");
}

// Admin Funktionen
function loadItems(){
  fetch("/items").then(r=>r.json()).then(d=>{items=d;});
}

function searchItems(){
  const text=document.getElementById("searchText").value.toLowerCase();
  const cat=document.getElementById("category").value;
  const results=document.getElementById("searchResults");
  results.innerHTML="";
  for(let k in items){
    let v=items[k];
    if((!cat || cat==="") && k.toLowerCase().includes(text)) results.innerHTML+=k+" → "+v+"<br>";
    else if(cat && k.toLowerCase().includes(text)) results.innerHTML+=k+" → "+v+"<br>";
  }
}

function announce(){
  const text=document.getElementById("announceText").value;
  if(!text) return;
  fetch("/announcement",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text,email})})
  .then(r=>r.json()).then(d=>{
    if(d.ok){
      addAnnouncement(d.entry.text);
      document.getElementById("announceText").value="";
    }
  });
}

function loadAnnouncements(){
  fetch("/announcements").then(r=>r.json()).then(arr=>{
    for(let a of arr) addAnnouncement(a.text);
  });
}

function addAnnouncement(text){
  const d=document.createElement("div");
  d.className="announcement";
  d.textContent=text;
  document.getElementById("announcements").prepend(d);
  setTimeout(()=>d.remove(),5000+text.length*50);
}
</script>

</body>
</html>
